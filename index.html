<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarot Digital - Pembacaan Spiritual Offline</title>
    <style>
        :root {
            --primary-purple: #4a1e6a;
            --dark-blue: #1a1a2e;
            --gold: #d4af37;
            --black: #0d0d0d;
            --light-purple: #6d3b8c;
            --text-light: #f0e6ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--dark-blue), var(--black));
            color: var(--text-light);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--gold);
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
        }

        .main-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .menu-card {
            background: rgba(74, 30, 106, 0.3);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .menu-card h3 {
            color: var(--gold);
            margin-bottom: 15px;
        }

        .menu-card p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }

        .tarot-card {
            width: 150px;
            height: 250px;
            perspective: 1000px;
            cursor: pointer;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .tarot-card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        .card-front {
            background: linear-gradient(45deg, #2c0c4d, #5a2a7f);
            border: 2px solid var(--gold);
        }

        .card-front::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, transparent 30%, rgba(0, 0, 0, 0.5) 100%);
        }

        .card-symbol {
            font-size: 3rem;
            color: var(--gold);
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.7);
            z-index: 1;
        }

        .card-back {
            background: linear-gradient(135deg, #1a0b2e, #3d1b5c);
            transform: rotateY(180deg);
            border: 2px solid var(--gold);
            padding: 15px;
            flex-direction: column;
            justify-content: space-between;
        }

        .card-title {
            color: var(--gold);
            font-size: 1.1rem;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(212, 175, 55, 0.5);
            margin-bottom: 5px;
        }

        .card-status {
            font-size: 0.8rem;
            color: #ffcc00;
            font-style: italic;
        }

        .card-image {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin: 10px 0;
        }

        .card-svg {
            width: 80px;
            height: 80px;
            filter: drop-shadow(0 0 5px rgba(212, 175, 55, 0.5));
        }

        .card-content {
            padding: 15px;
            text-align: center;
        }

        .card-content h3 {
            color: var(--gold);
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        button {
            background: var(--primary-purple);
            color: var(--text-light);
            border: 1px solid var(--gold);
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        button:hover {
            background: var(--light-purple);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .interpretation {
            background: rgba(26, 26, 46, 0.7);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            border-left: 3px solid var(--gold);
        }

        .interpretation h3 {
            color: var(--gold);
            margin-bottom: 15px;
        }

        .interpretation-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }

        .interpretation-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .hidden {
            display: none;
        }

        .reading-archive {
            margin-top: 40px;
        }

        .archive-item {
            background: rgba(74, 30, 106, 0.3);
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 3px solid var(--gold);
        }

        footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            border-top: 1px solid rgba(212, 175, 55, 0.3);
            font-size: 0.9rem;
            opacity: 0.7;
        }

        textarea {
            width: 100%;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid var(--gold);
            border-radius: 5px;
            resize: vertical;
            min-height: 80px;
        }

        select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid var(--gold);
            border-radius: 5px;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .main-menu {
                grid-template-columns: 1fr;
            }
            
            .tarot-card {
                width: 120px;
                height: 200px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Tarot Digital</h1>
            <p class="subtitle">Pembacaan Spiritual yang Mendalam - Sepenuhnya Offline</p>
        </header>

        <main>
            <!-- Halaman Utama -->
            <section id="home-page">
                <div class="main-menu">
                    <div class="menu-card" onclick="showReadingPage('single')">
                        <h3>Kartu Tunggal</h3>
                        <p>Pembacaan sederhana dengan satu kartu untuk wawasan cepat tentang situasi saat ini.</p>
                    </div>
                    <div class="menu-card" onclick="showReadingPage('three')">
                        <h3>Tiga Kartu</h3>
                        <p>Masa lalu, sekarang, dan masa depan. Pemahaman yang lebih mendalam tentang perjalanan hidup Anda.</p>
                    </div>
                    <div class="menu-card" onclick="showReadingPage('celtic')">
                        <h3>Celtic Cross</h3>
                        <p>Pembacaan komprehensif dengan 10 kartu untuk analisis mendalam tentang situasi kompleks.</p>
                    </div>
                </div>

                <div class="menu-card">
                    <h3>Pembacaan Berdasarkan Pertanyaan</h3>
                    <p>Ajukan pertanyaan spesifik dan dapatkan panduan dari kartu tarot.</p>
                    <textarea id="question-input" placeholder="Tulis pertanyaan Anda di sini..." rows="3"></textarea>
                    <button onclick="startQuestionReading()">Dapatkan Pembacaan</button>
                </div>

                <div class="controls">
                    <button onclick="showArchive()">Lihat Arsip Pembacaan</button>
                    <button onclick="showSettings()">Pengaturan</button>
                </div>
            </section>

            <!-- Halaman Pembacaan -->
            <section id="reading-page" class="hidden">
                <h2 id="reading-title">Pembacaan Kartu Tarot</h2>
                
                <div class="controls">
                    <button onclick="shuffleCards()">Acak Kartu</button>
                    <button onclick="flipAllCards()">Balik Semua Kartu</button>
                    <button onclick="saveReading()">Simpan Pembacaan</button>
                    <button onclick="showHomePage()">Kembali ke Beranda</button>
                </div>

                <div class="card-container" id="card-container">
                    <!-- Kartu tarot akan di-generate oleh JavaScript -->
                </div>

                <div class="interpretation" id="interpretation">
                    <h3>Interpretasi</h3>
                    <div id="interpretation-text">
                        <p>Pilih atau acak kartu untuk melihat interpretasi.</p>
                    </div>
                </div>
            </section>

            <!-- Halaman Arsip -->
            <section id="archive-page" class="hidden">
                <h2>Arsip Pembacaan</h2>
                <button onclick="showHomePage()">Kembali ke Beranda</button>
                
                <div class="reading-archive" id="reading-archive">
                    <!-- Arsip pembacaan akan diisi oleh JavaScript -->
                </div>
            </section>

            <!-- Halaman Pengaturan -->
            <section id="settings-page" class="hidden">
                <h2>Pengaturan</h2>
                <button onclick="showHomePage()">Kembali ke Beranda</button>
                
                <div class="menu-card" style="text-align: left;">
                    <h3>Personaliasi Berdasarkan Zodiak</h3>
                    <p>Pilih zodiak Anda untuk pembacaan yang lebih personal.</p>
                    <select id="zodiac-select">
                        <option value="">Pilih Zodiak</option>
                        <option value="aries">Aries</option>
                        <option value="taurus">Taurus</option>
                        <option value="gemini">Gemini</option>
                        <option value="cancer">Cancer</option>
                        <option value="leo">Leo</option>
                        <option value="virgo">Virgo</option>
                        <option value="libra">Libra</option>
                        <option value="scorpio">Scorpio</option>
                        <option value="sagittarius">Sagittarius</option>
                        <option value="capricorn">Capricorn</option>
                        <option value="aquarius">Aquarius</option>
                        <option value="pisces">Pisces</option>
                    </select>
                    
                    <h3>Kategori Pembacaan</h3>
                    <p>Pilih kategori fokus untuk pembacaan tarot.</p>
                    <select id="category-select">
                        <option value="general">Umum</option>
                        <option value="love">Cinta & Hubungan</option>
                        <option value="career">Karier & Keuangan</option>
                        <option value="health">Kesehatan</option>
                        <option value="spiritual">Spiritualitas</option>
                    </select>
                    
                    <button onclick="saveSettings()">Simpan Pengaturan</button>
                </div>
                
                <div class="menu-card">
                    <h3>Suara Ambient</h3>
                    <p>Nyalakan atau matikan suara latar untuk pengalaman yang lebih imersif.</p>
                    <button id="audio-toggle" onclick="toggleAudio()">Nyalakan Suara</button>
                </div>
            </section>
        </main>

        <footer>
            <p>Tarot Digital - Pembacaan Spiritual Offline © 2023</p>
            <p>Website ini berfungsi sepenuhnya tanpa koneksi internet</p>
        </footer>
    </div>

    <script>
        // Data kartu tarot yang lebih lengkap
        const tarotDeck = [
            {
                name: "The Fool",
                image: "fool",
                meanings: {
                    general: "Awal baru, kebebasan, petualangan, ketidaktahuan",
                    love: "Hubungan baru, mengambil risiko dalam cinta",
                    career: "Memulai proyek baru, perubahan karir",
                    health: "Energi baru, pendekatan segar untuk kesehatan",
                    spiritual: "Perjalanan spiritual, kepercayaan pada alam semesta"
                },
                reversed: {
                    general: "Kecerobohan, risiko yang tidak diperhitungkan, penundaan",
                    love: "Ketidakdewasaan dalam hubungan, menghindari komitmen",
                    career: "Keputusan buruk, kurang perencanaan",
                    health: "Kecerobohan dengan kesehatan, mengabaikan gejala",
                    spiritual: "Hilang arah, kurang keyakinan"
                },
                symbol: "♊"
            },
            {
                name: "The Magician",
                image: "magician",
                meanings: {
                    general: "Kekuatan, kemauan, manifestasi, sumber daya",
                    love: "Kemampuan untuk menarik pasangan, komunikasi efektif",
                    career: "Memanfaatkan keterampilan, inisiatif, kreativitas",
                    health: "Penyembuhan aktif, mengambil kendali atas kesehatan",
                    spiritual: "Hubungan dengan kekuatan spiritual, manifestasi keinginan"
                },
                reversed: {
                    general: "Penyalahgunaan kekuatan, manipulasi, kurangnya arah",
                    love: "Manipulasi dalam hubungan, komunikasi yang buruk",
                    career: "Keterampilan tidak digunakan, proyek mandek",
                    health: "Kekurangan energi, ketidakseimbangan",
                    spiritual: "Penyalahgunaan kekuatan spiritual, egoisme"
                },
                symbol: "♌"
            },
            {
                name: "The High Priestess",
                image: "high_priestess",
                meanings: {
                    general: "Intuisi, misteri, kebijaksanaan batin, hal yang tersembunyi",
                    love: "Koneksi spiritual, hubungan yang penuh rahasia",
                    career: "Mengandalkan intuisi dalam pekerjaan, proyek rahasia",
                    health: "Penyembuhan holistik, mendengarkan tubuh",
                    spiritual: "Koneksi dengan alam bawah sadar, kebijaksanaan spiritual"
                },
                reversed: {
                    general: "Mengabaikan intuisi, rahasia terbongkar, ketidakseimbangan",
                    love: "Rahasia yang merusak hubungan, kurang kejujuran",
                    career: "Mengabaikan firasat, informasi yang disembunyikan",
                    health: "Mengabaikan gejala, ketidakseimbangan emosional",
                    spiritual: "Terputus dari intuisi, kebingungan spiritual"
                },
                symbol: "🌙"
            },
            {
                name: "The Empress",
                image: "empress",
                meanings: {
                    general: "Kesuburan, keibuan, kreativitas, kelimpahan",
                    love: "Cinta yang penuh perhatian, hubungan yang subur",
                    career: "Kesuksesan kreatif, kemakmuran bisnis",
                    health: "Kesehatan reproduksi, kesejahteraan fisik",
                    spiritual: "Koneksi dengan alam, energi feminin"
                },
                reversed: {
                    general: "Ketidaksuburan, ketergantungan, pemborosan",
                    love: "Cinta yang mencekik, ketergantungan emosional",
                    career: "Kreativitas terhambat, kemandulan ide",
                    health: "Masalah kesuburan, ketidakseimbangan hormon",
                    spiritual: "Terputus dari alam, energi feminin tertekan"
                },
                symbol: "👑"
            },
            {
                name: "The Emperor",
                image: "emperor",
                meanings: {
                    general: "Otoritas, struktur, stabilitas, kepemimpinan",
                    love: "Hubungan yang terstruktur, komitmen kuat",
                    career: "Kepemimpinan, organisasi, pencapaian tujuan",
                    health: "Disiplin kesehatan, rutinitas yang teratur",
                    spiritual: "Struktur spiritual, disiplin praktik"
                },
                reversed: {
                    general: "Kontrol berlebihan, kekakuan, tirani",
                    love: "Dominasi dalam hubungan, kurang fleksibilitas",
                    career: "Otoriter, birokrasi berlebihan",
                    health: "Mengabaikan kesehatan, disiplin longgar",
                    spiritual: "Dogmatis, kurang fleksibilitas spiritual"
                },
                symbol: "♈"
            },
            {
                name: "The Lovers",
                image: "lovers",
                meanings: {
                    general: "Cinta, hubungan, pilihan, harmoni",
                    love: "Hubungan yang penuh cinta, keputusan romantis",
                    career: "Kemitraan bisnis, kolaborasi yang harmonis",
                    health: "Keseimbangan emosional, kesehatan hubungan",
                    spiritual: "Kesatuan, koneksi spiritual yang mendalam"
                },
                reversed: {
                    general: "Konflik, ketidakseimbangan, pilihan sulit",
                    love: "Perselisihan, ketidakcocokan, perpisahan",
                    career: "Kemitraan bermasalah, konflik di tempat kerja",
                    health: "Ketidakseimbangan emosional, stres hubungan",
                    spiritual: "Perpecahan, ketidakharmonisan spiritual"
                },
                symbol: "💑"
            },
            {
                name: "The Chariot",
                image: "chariot",
                meanings: {
                    general: "Kemenangan, kemauan, kendali, perjalanan",
                    love: "Hubungan yang berkembang, mengatasi rintangan",
                    career: "Kemajuan karier, mengatasi persaingan",
                    health: "Pemulihan, mengatasi penyakit",
                    spiritual: "Perjalanan spiritual, kendali diri"
                },
                reversed: {
                    general: "Kekacauan, kurang kendali, kemacetan",
                    love: "Konflik dalam hubungan, kurang arah",
                    career: "Kemacetan proyek, persaingan tidak sehat",
                    health: "Kemunduran kesehatan, kurang disiplin",
                    spiritual: "Kebingungan spiritual, kurang fokus"
                },
                symbol: "⚔️"
            },
            {
                name: "Strength",
                image: "strength",
                meanings: {
                    general: "Kekuatan batin, keberanian, belas kasih, ketahanan",
                    love: "Cinta yang kuat, hubungan yang tahan uji",
                    career: "Ketekunan, mengatasi tantangan",
                    health: "Kekuatan fisik dan mental, pemulihan",
                    spiritual: "Kekuatan spiritual, ketahanan iman"
                },
                reversed: {
                    general: "Keraguan diri, kelemahan, ketakutan",
                    love: "Ketergantungan, hubungan tidak seimbang",
                    career: "Kurang kepercayaan diri, menyerah",
                    health: "Kelemahan fisik, kelelahan mental",
                    spiritual: "Keraguan spiritual, kehilangan iman"
                },
                symbol: "🦁"
            },
            {
                name: "The Hermit",
                image: "hermit",
                meanings: {
                    general: "Introspeksi, kebijaksanaan, pencarian, kesendirian",
                    love: "Waktu untuk diri sendiri, evaluasi hubungan",
                    career: "Perencanaan strategis, mencari tujuan",
                    health: "Penyembuhan internal, istirahat yang diperlukan",
                    spiritual: "Pencarian spiritual, kebijaksanaan batin"
                },
                reversed: {
                    general: "Isolasi, kesepian, menghindar dari dunia",
                    love: "Menghindari hubungan, ketakutan akan keintiman",
                    career: "Penundaan, kurang arah",
                    health: "Mengabaikan kesehatan, isolasi sosial",
                    spiritual: "Kebingungan spiritual, kurang bimbingan"
                },
                symbol: "🕯️"
            },
            {
                name: "Wheel of Fortune",
                image: "wheel",
                meanings: {
                    general: "Perubahan, siklus, takdir, peluang",
                    love: "Perubahan dalam hubungan, pertemuan tak terduga",
                    career: "Perubahan karir, peluang baru",
                    health: "Perubahan kondisi kesehatan, siklus pemulihan",
                    spiritual: "Siklus spiritual, penerimaan takdir"
                },
                reversed: {
                    general: "Kemalangan, resistensi terhadap perubahan, stagnasi",
                    love: "Masalah hubungan yang berulang, ketidakpastian",
                    career: "Hambatan, peluang yang terlewat",
                    health: "Kesehatan yang fluktuatif, kemunduran",
                    spiritual: "Melawan takdir, ketidakpercayaan pada siklus"
                },
                symbol: "🔄"
            }
        ];

        // Variabel global
        let currentReading = [];
        let currentReadingType = "";
        let audioContext = null;
        let oscillator = null;
        let gainNode = null;
        let audioEnabled = false;
        let userSettings = {
            zodiac: "",
            category: "general"
        };

        // Inisialisasi
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            initializeAudio();
            updateAudioButton();
        });

        // Fungsi untuk inisialisasi audio
        function initializeAudio() {
            try {
                // Buat context audio
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                gainNode = audioContext.createGain();
                gainNode.connect(audioContext.destination);
                gainNode.gain.value = 0.1; // Volume rendah untuk suara ambient
            } catch (e) {
                console.log("Web Audio API tidak didukung di browser ini");
            }
        }

        // Fungsi untuk menampilkan halaman pembacaan
        function showReadingPage(type) {
            document.getElementById('home-page').classList.add('hidden');
            document.getElementById('reading-page').classList.remove('hidden');
            document.getElementById('archive-page').classList.add('hidden');
            document.getElementById('settings-page').classList.add('hidden');
            
            currentReadingType = type;
            let title = "";
            let cardCount = 1;
            
            switch(type) {
                case 'single':
                    title = "Pembacaan Kartu Tunggal";
                    cardCount = 1;
                    break;
                case 'three':
                    title = "Pembacaan Tiga Kartu - Masa Lalu, Sekarang, Masa Depan";
                    cardCount = 3;
                    break;
                case 'celtic':
                    title = "Pembacaan Celtic Cross";
                    cardCount = 10;
                    break;
            }
            
            document.getElementById('reading-title').textContent = title;
            generateCardLayout(cardCount);
            playCardSound();
        }

        // Fungsi untuk menghasilkan layout kartu
        function generateCardLayout(count) {
            const container = document.getElementById('card-container');
            container.innerHTML = '';
            currentReading = [];
            
            for (let i = 0; i < count; i++) {
                const cardElement = document.createElement('div');
                cardElement.className = 'tarot-card';
                cardElement.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="card-symbol">✨</div>
                        </div>
                        <div class="card-back">
                            <div class="card-title">Kartu ${i+1}</div>
                            <div class="card-image">
                                <div class="card-symbol">⏳</div>
                            </div>
                            <div class="card-status">Klik untuk membalik</div>
                        </div>
                    </div>
                `;
                
                cardElement.addEventListener('click', function() {
                    this.classList.toggle('flipped');
                    if (this.classList.contains('flipped')) {
                        const cardIndex = Array.from(container.children).indexOf(this);
                        if (!currentReading[cardIndex]) {
                            drawRandomCard(cardIndex);
                        }
                        updateInterpretation();
                        playCardSound();
                    }
                });
                
                container.appendChild(cardElement);
                currentReading.push(null); // Placeholder untuk kartu yang akan ditarik
            }
        }

        // Fungsi untuk menarik kartu acak
        function drawRandomCard(index) {
            const randomIndex = Math.floor(Math.random() * tarotDeck.length);
            const card = {...tarotDeck[randomIndex]};
            
            // Tentukan apakah kartu terbalik (30% kemungkinan)
            card.reversed = Math.random() > 0.7;
            
            currentReading[index] = card;
            
            // Update tampilan kartu
            const cardElement = document.getElementById('card-container').children[index];
            const cardBack = cardElement.querySelector('.card-back');
            cardBack.innerHTML = `
                <div class="card-title">${card.name}</div>
                <div class="card-image">
                    <div class="card-symbol">${card.symbol}</div>
                </div>
                <div class="card-status">${card.reversed ? '(Terbalik)' : ''}</div>
            `;
        }

        // Fungsi untuk mengacak semua kartu
        function shuffleCards() {
            for (let i = 0; i < currentReading.length; i++) {
                const cardElement = document.getElementById('card-container').children[i];
                cardElement.classList.remove('flipped');
                
                // Reset kartu setelah jeda untuk animasi
                setTimeout(() => {
                    drawRandomCard(i);
                }, 300);
            }
            
            // Reset interpretasi
            document.getElementById('interpretation-text').innerHTML = "<p>Kartu telah diacak. Klik pada kartu untuk melihat interpretasi.</p>";
            playCardSound();
        }

        // Fungsi untuk membalik semua kartu
        function flipAllCards() {
            const cards = document.querySelectorAll('.tarot-card');
            let allAlreadyFlipped = true;
            
            cards.forEach(card => {
                if (!card.classList.contains('flipped')) {
                    allAlreadyFlipped = false;
                }
                card.classList.add('flipped');
                
                // Jika kartu belum ditarik, tarik kartu acak
                const index = Array.from(card.parentNode.children).indexOf(card);
                if (!currentReading[index]) {
                    drawRandomCard(index);
                }
            });
            
            if (!allAlreadyFlipped) {
                playCardSound();
            }
            
            updateInterpretation();
        }

        // Fungsi untuk memperbarui interpretasi
        function updateInterpretation() {
            const interpretationElement = document.getElementById('interpretation-text');
            let interpretationHTML = "";
            
            // Periksa apakah semua kartu sudah terbuka
            const allFlipped = Array.from(document.querySelectorAll('.tarot-card')).every(card => 
                card.classList.contains('flipped')
            );
            
            if (!allFlipped) {
                interpretationHTML = "<p>Balik semua kartu untuk melihat interpretasi lengkap.</p>";
            } else {
                interpretationHTML = "<h4>Interpretasi Pembacaan:</h4>";
                
                currentReading.forEach((card, index) => {
                    if (card) {
                        const positionText = getPositionText(index, currentReadingType);
                        let meaning = "";
                        
                        if (card.reversed) {
                            // Pastikan reversed meaning ada, jika tidak gunakan yang regular
                            meaning = card.reversed[userSettings.category] || 
                                     "Makna terbalik tidak tersedia untuk kategori ini. " + card.meanings[userSettings.category];
                        } else {
                            meaning = card.meanings[userSettings.category];
                        }
                        
                        interpretationHTML += `
                            <div class="interpretation-item">
                                <p><strong>${positionText}: ${card.name} ${card.reversed ? '(Terbalik)' : ''}</strong></p>
                                <p>${meaning}</p>
                            </div>
                        `;
                    }
                });
                
                // Tambahkan interpretasi berdasarkan zodiak jika dipilih
                if (userSettings.zodiac) {
                    interpretationHTML += `<p><em>Berdasarkan zodiak ${userSettings.zodiac}, pembacaan ini menunjukkan kecenderungan untuk petualangan dan eksplorasi spiritual.</em></p>`;
                }
            }
            
            interpretationElement.innerHTML = interpretationHTML;
        }

        // Fungsi untuk mendapatkan teks posisi berdasarkan jenis pembacaan
        function getPositionText(index, type) {
            switch(type) {
                case 'single':
                    return "Pembacaan";
                case 'three':
                    const positions = ["Masa Lalu", "Sekarang", "Masa Depan"];
                    return positions[index] || `Posisi ${index+1}`;
                case 'celtic':
                    const celticPositions = [
                        "Situasi Saat Ini", "Tantangan", "Tujuan Sadar", 
                        "Dasar", "Masa Lalu", "Masa Depan", 
                        "Diri Sendiri", "Lingkungan", "Harapan & Ketakutan", 
                        "Hasil"
                    ];
                    return celticPositions[index] || `Posisi ${index+1}`;
                default:
                    return `Kartu ${index+1}`;
            }
        }

        // Fungsi untuk menyimpan pembacaan
        function saveReading() {
            const allFlipped = Array.from(document.querySelectorAll('.tarot-card')).every(card => 
                card.classList.contains('flipped')
            );
            
            if (!allFlipped) {
                alert("Harap balik semua kartu sebelum menyimpan pembacaan.");
                return;
            }
            
            const reading = {
                type: currentReadingType,
                cards: currentReading.map(card => ({
                    name: card.name,
                    reversed: card.reversed,
                    meaning: card.reversed ? 
                        (card.reversed[userSettings.category] || "Makna terbalik tidak tersedia") : 
                        card.meanings[userSettings.category]
                })),
                date: new Date().toLocaleDateString('id-ID'),
                time: new Date().toLocaleTimeString('id-ID'),
                question: document.getElementById('question-input').value || "Tidak ada pertanyaan spesifik",
                settings: {...userSettings}
            };
            
            // Simpan ke localStorage
            let savedReadings = JSON.parse(localStorage.getItem('tarotReadings') || '[]');
            savedReadings.push(reading);
            localStorage.setItem('tarotReadings', JSON.stringify(savedReadings));
            
            alert("Pembacaan berhasil disimpan!");
        }

        // Fungsi untuk memulai pembacaan berdasarkan pertanyaan
        function startQuestionReading() {
            const question = document.getElementById('question-input').value.trim();
            if (!question) {
                alert("Silakan masukkan pertanyaan terlebih dahulu.");
                return;
            }
            
            showReadingPage('single');
            setTimeout(() => {
                shuffleCards();
            }, 500);
        }

        // Fungsi untuk menampilkan arsip
        function showArchive() {
            document.getElementById('home-page').classList.add('hidden');
            document.getElementById('reading-page').classList.add('hidden');
            document.getElementById('archive-page').classList.remove('hidden');
            document.getElementById('settings-page').classList.add('hidden');
            
            const archiveContainer = document.getElementById('reading-archive');
            archiveContainer.innerHTML = '';
            
            const savedReadings = JSON.parse(localStorage.getItem('tarotReadings') || '[]');
            
            if (savedReadings.length === 0) {
                archiveContainer.innerHTML = '<p>Belum ada pembacaan yang disimpan.</p>';
                return;
            }
            
            savedReadings.forEach((reading, index) => {
                const archiveItem = document.createElement('div');
                archiveItem.className = 'archive-item';
                
                let cardList = reading.cards.map(card => 
                    `${card.name} ${card.reversed ? '(Terbalik)' : ''}`
                ).join(', ');
                
                archiveItem.innerHTML = `
                    <h3>Pembacaan ${getReadingTypeText(reading.type)} - ${reading.date} ${reading.time}</h3>
                    <p><strong>Pertanyaan:</strong> ${reading.question}</p>
                    <p><strong>Kategori:</strong> ${getCategoryText(reading.settings.category)}</p>
                    <p><strong>Kartu:</strong> ${cardList}</p>
                    <button onclick="deleteReading(${index})">Hapus</button>
                `;
                
                archiveContainer.appendChild(archiveItem);
            });
        }

        // Fungsi untuk menghapus pembacaan dari arsip
        function deleteReading(index) {
            let savedReadings = JSON.parse(localStorage.getItem('tarotReadings') || '[]');
            savedReadings.splice(index, 1);
            localStorage.setItem('tarotReadings', JSON.stringify(savedReadings));
            showArchive(); // Refresh tampilan arsip
        }

        // Fungsi untuk mendapatkan teks jenis pembacaan
        function getReadingTypeText(type) {
            switch(type) {
                case 'single': return 'Kartu Tunggal';
                case 'three': return 'Tiga Kartu';
                case 'celtic': return 'Celtic Cross';
                default: return type;
            }
        }

        // Fungsi untuk mendapatkan teks kategori
        function getCategoryText(category) {
            switch(category) {
                case 'general': return 'Umum';
                case 'love': return 'Cinta & Hubungan';
                case 'career': return 'Karier & Keuangan';
                case 'health': return 'Kesehatan';
                case 'spiritual': return 'Spiritualitas';
                default: return category;
            }
        }

        // Fungsi untuk menampilkan pengaturan
        function showSettings() {
            document.getElementById('home-page').classList.add('hidden');
            document.getElementById('reading-page').classList.add('hidden');
            document.getElementById('archive-page').classList.add('hidden');
            document.getElementById('settings-page').classList.remove('hidden');
            
            // Isi nilai pengaturan yang sudah disimpan
            document.getElementById('zodiac-select').value = userSettings.zodiac;
            document.getElementById('category-select').value = userSettings.category;
        }

        // Fungsi untuk menyimpan pengaturan
        function saveSettings() {
            userSettings.zodiac = document.getElementById('zodiac-select').value;
            userSettings.category = document.getElementById('category-select').value;
            
            localStorage.setItem('tarotSettings', JSON.stringify(userSettings));
            alert("Pengaturan berhasil disimpan!");
        }

        // Fungsi untuk memuat pengaturan
        function loadSettings() {
            const savedSettings = localStorage.getItem('tarotSettings');
            if (savedSettings) {
                userSettings = JSON.parse(savedSettings);
            }
        }

        // Fungsi untuk kembali ke beranda
        function showHomePage() {
            document.getElementById('home-page').classList.remove('hidden');
            document.getElementById('reading-page').classList.add('hidden');
            document.getElementById('archive-page').classList.add('hidden');
            document.getElementById('settings-page').classList.add('hidden');
        }

        // Fungsi untuk mengontrol audio
        function toggleAudio() {
            audioEnabled = !audioEnabled;
            updateAudioButton();
            
            if (audioEnabled) {
                playAmbientSound();
            } else {
                stopAmbientSound();
            }
        }

        function updateAudioButton() {
            document.getElementById('audio-toggle').textContent = 
                audioEnabled ? "Matikan Suara" : "Nyalakan Suara";
        }

        function playAmbientSound() {
            if (!audioContext || oscillator) return;
            
            try {
                oscillator = audioContext.createOscillator();
                oscillator.type = 'sine';
                oscillator.frequency.value = 220; // Frekuensi rendah untuk suara ambient
                
                const gain = audioContext.createGain();
                gain.gain.value = 0.02; // Volume sangat rendah
                
                oscillator.connect(gain);
                gain.connect(audioContext.destination);
                
                oscillator.start();
            } catch (e) {
                console.log("Error memutar suara ambient:", e);
            }
        }

        function stopAmbientSound() {
            if (oscillator) {
                oscillator.stop();
                oscillator = null;
            }
        }

        function playCardSound() {
            if (!audioContext || !audioEnabled) return;
            
            try {
                const oscillator = audioContext.createOscillator();
                const gain = audioContext.createGain();
                
                oscillator.connect(gain);
                gain.connect(audioContext.destination);
                
                // Suara pendek untuk kartu
                oscillator.type = 'sine';
                oscillator.frequency.value = 440;
                gain.gain.value = 0.1;
                
                oscillator.start();
                
                // Fade out
                gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
                
                setTimeout(() => {
                    oscillator.stop();
                }, 300);
            } catch (e) {
                console.log("Error memutar suara kartu:", e);
            }
        }
    </script>
</body>
</html>
